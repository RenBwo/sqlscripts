#+STARTUP: indent
** 1.工资类型
   工资根据人员可以分为行政人员 计件人员 参照行政管理的人员 车间管理者
   根据计算方法,可以分为计时工资\计件工资\系数工资
** 2.税前工资构成
*** 2.1 行政人员工资=计时基本工资+奖项-扣减项
    计时基本工资: 根据出勤计时*工资计算标准
    奖项:   需要计入税前工资的奖励部分
    扣减项: 需要计入税前工资的扣减部分
*** 2.2 计件人员工资=计件基本工资+计时基本工资+奖项-扣减项
    计件基本工资:ERP计件工资数据引入,手工EXCE整理的计件工资数据
    计时基本工资:计件人员有一部分按计时计算的工资
    奖项:   需要计入工资的增加项
    扣减项: 需要计入工资的扣减项

*** 2.3 车间管理者工资=本部门平均工资*系数+奖项-扣减项
系数:根据绩效考核确定的系数
** 3.计算方法
*** 非系数人员工资计算公式
//先计算非系数人员的工资
If 工资类型 <> "系数" Then

//年
年=getsysconst(0,0,0,0,"年")

//月
月=getsysconst(0,0,0,0,"月份")

//工龄计算
If 特殊工龄+fix((12*年+月-1-12*getyear(入职日期)-getmonth(入职日期))/12) >= 5 Then 
工龄=5
ELSE
 工龄=特殊工龄+fix((12*年+月-1-12*getyear(入职日期)-getmonth(入职日期))/12)
Endif
 
 //小时薪酬
 小时薪酬=roundx(基本工资/21.75/8 , 4)
 
 //正常计时薪酬（一线）
 if 职等 =11 Or 职等 =12 Then
    正常计时薪酬（一线）=小时薪酬*出勤小时
 endIf 
 if 职等 =13 Then
    正常计时薪酬（一线）=小时薪酬*计件人员付薪小时
 endIf 
 
 //正常加班薪酬
if 职等 <9 then
 正常加班薪酬=小时薪酬*40
else
 正常加班薪酬=小时薪酬*1.5*正常加班小时 
endif
 
 //计件工资合计
 计件工资合计=计件工资（excel导入）+计件工资（erp）
 
 //法假薪酬
  if 职等 > 10 And 职等 < 14 Then
  法假薪酬=小时薪酬*8+小时薪酬*2*法假出勤小时
  Else
  法假薪酬=小时薪酬*2*法假出勤小时
  endif
 
 //工龄补贴
 工龄补贴=工龄*工龄工资标准
 
 //考勤就餐补贴
 考勤就餐补贴=(出勤小时+正常加班小时+法假出勤小时-夜班小时)/6*8
 
 //应计就餐费用
 If 实际就餐费用 < 考勤就餐补贴 Or 职等 <9 Then
 应计就餐费用=实际就餐费用
 Else
  应计就餐费用=考勤就餐补贴
 endif
 
 
 //夜班就餐补贴
 If (职等 = 9 Or 职等 = 11 Or 职等 = 12 Or 职等 = 13 ) Then
 夜班就餐补贴=1.5*夜班小时
 ElseIf 职等 = 14 then
 夜班就餐补贴=0.75*夜班小时
 Else
 夜班就餐补贴=0
 endif
 
 //交通补贴
if 职等 <9 then
 交通补贴=非系数执行工资-基本工资-住房补贴-正常加班薪酬
else 
 交通补贴=非系数执行工资-基本工资-住房补贴
endif
 
 //请假欠勤
 If 职等 <= 10 Then
   If 报工请假小时 < ERP请假小时 Then
    请假欠勤=-1*ERP请假小时*(非系数执行工资+工龄补贴+燃油补贴+通讯补贴)/21.75/8
   Else
    请假欠勤=-1*报工请假小时*(非系数执行工资+工龄补贴+燃油补贴+通讯补贴)/21.75/8
   ENDIF
 Else 
   If 报工请假小时 < ERP请假小时 Then
    请假欠勤=-1*ERP请假小时*(工龄补贴+燃油补贴+通讯补贴+代班津贴+高温补贴+特殊岗位补贴+住房补贴+技能工资+绩效激励+其他补贴)/21.75/8
   Else
    请假欠勤=-1*报工请假小时*(工龄补贴+燃油补贴+通讯补贴+代班津贴+高温补贴+特殊岗位补贴+住房补贴+技能工资+绩效激励+其他补贴)/21.75/8
   ENDIF
 ENDIF
 
 //应付工资
 If 职等 < 10 then
 应付工资=基本工资+正常计时薪酬（一线）+正常加班薪酬+计件工资合计+法假薪酬+工龄补贴+通讯补贴+燃油补贴+交通补贴+代班津贴+应计就餐费用+夜班就餐补贴+高温补贴+特殊岗位补贴+住房补贴+绩效激励+其他补贴+请假欠勤
 Else 
  应付工资=正常计时薪酬（一线）+正常加班薪酬+计件工资合计+法假薪酬+工龄补贴+通讯补贴+燃油补贴+交通补贴+代班津贴+应计就餐费用+夜班就餐补贴+高温补贴+特殊岗位补贴+住房补贴+绩效激励+其他补贴+请假欠勤
 Endif 
 

 //住房公积金
 住房公积金=GetSysConst(0,0,0,0,"住房公积金")
 
 
 //养老保险
 养老保险=ROUNDX(保险基数*0.08,2)
 
 //医疗保险
 医疗保险=ROUNDX(保险基数*0.02,2)
 
 //失业保险
 失业保险=ROUNDX(保险基数*0.003,2)
 
 //保险个人部分合计
 保险个人部分合计=养老保险+医疗保险+失业保险+住房公积金
 
 //个人所得税
 If 应付工资-保险个人部分合计-35000 <=0 Then
 个人所得税=0
 ElseIf 应付工资-保险个人部分合计-35000 <=1500 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.03
    ElseIf 应付工资-保险个人部分合计-35000 <=45000 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.1-105
       ElseIf 应付工资-保险个人部分合计-35000 <=9000 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.2-555
			ElseIf 应付工资-保险个人部分合计-35000 <=35000 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.25-1005
			
	Endif	
  
 //实发工资
 实发工资=应付工资-保险个人部分合计-个人所得税-税后扣缴-实际就餐费用
Else
//再计算系数人员工资
ENDIF

*** 系数工资人员计算公式
//2 计算系数人员的工资
If 工资类型 = "系数" Then

//年
年=getsysconst(0,0,0,0,"年")

//月
月=getsysconst(0,0,0,0,"月份")

//工龄计算
If 特殊工龄+fix((12*年+月-1-12*getyear(入职日期)-getmonth(入职日期))/12) >= 5 Then 
工龄=5
ELSE
 工龄=特殊工龄+fix((12*年+月-1-12*getyear(入职日期)-getmonth(入职日期))/12)
Endif
 
 //小时薪酬
 小时薪酬=roundx(基本工资/21.75/8 , 4)
 
 //正常计时薪酬（一线）
// if 职等 > 10 And 职等 < 14 Then
//    正常计时薪酬（一线）=小时薪酬*出勤小时
// endIf 
 
 //正常加班薪酬
if 职等 <10 then
 正常加班薪酬=小时薪酬*40
else
 正常加班薪酬=小时薪酬*1.5*正常加班付薪小时 
endif

 //计件工资合计
 //计件工资合计=计件工资（excel导入）+计件工资（erp）
 
 //法假薪酬
 // if 职等 > 10 And 职等 < 14 Then
 // 法假薪酬=小时薪酬*8+小时薪酬*2*法假出勤小时
 // Else
 // 法假薪酬=小时薪酬*2*法假出勤小时
 // endif
 
 //工龄补贴
 工龄补贴=工龄*工龄工资标准
 
 //考勤就餐补贴
 考勤就餐补贴=(出勤小时+正常加班小时+法假出勤小时-夜班小时)/6*8
 
 //应计就餐费用
 If 实际就餐费用 < 考勤就餐补贴 Or 职等 <9  Then
 应计就餐费用=实际就餐费用
 Else
  应计就餐费用=考勤就餐补贴
 endif
 
 
 //夜班就餐补贴
 If (职等 = 9 Or 职等 = 11 Or 职等 = 12 Or 职等 = 13 ) Then
 夜班就餐补贴=1.5*夜班小时
 ElseIf 职等 = 14 then
 夜班就餐补贴=0.75*夜班小时
 Else
 夜班就餐补贴=0
 endif
 
 //交通补贴
if 职等 <10 then
 交通补贴=系数执行工资-基本工资-住房补贴-正常加班薪酬
else
 交通补贴=系数执行工资-基本工资-住房补贴
endif
 
 //请假欠勤
 If 出勤小时 >= 26*8 Then
    请假欠勤=0
   Else
    请假欠勤=-1*(26*8-出勤小时)*(系数执行工资+工龄补贴+燃油补贴+通讯补贴)/26/8
   ENDIF
 
 
 //应付工资
 应付工资=基本工资+正常计时薪酬（一线）+正常加班薪酬+计件工资合计+法假薪酬+工龄补贴+通讯补贴+燃油补贴+交通补贴+代班津贴+应计就餐费用+夜班就餐补贴+高温补贴+特殊岗位补贴+住房补贴+绩效激励+其他补贴+请假欠勤

 
 //住房公积金
 住房公积金=GetSysConst(0,0,0,0,"住房公积金")
 
 
 //养老保险
 养老保险=ROUNDX(保险基数*0.08,2)
 
 //医疗保险
 医疗保险=ROUNDX(保险基数*0.02,2)
 
 //失业保险
 失业保险=ROUNDX(保险基数*0.003,2)
 
 //保险个人部分合计
 保险个人部分合计=养老保险+医疗保险+失业保险+住房公积金
 
 //个人所得税
 If 应付工资-保险个人部分合计-35000 <=0 Then
 个人所得税=0
 ElseIf 应付工资-保险个人部分合计-35000 <=1500 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.03
    ElseIf 应付工资-保险个人部分合计-35000 <=45000 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.1-105
       ElseIf 应付工资-保险个人部分合计-35000 <=9000 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.2-555
			ElseIf 应付工资-保险个人部分合计-35000 <=35000 Then
		个人所得税=(应付工资-保险个人部分合计-3500)*0.25-1005
			
	Endif	
  
 //实发工资
 实发工资=应付工资-保险个人部分合计-个人所得税-税后扣缴-实际就餐费用

ENDIF

** 4.操作说明 
*** 部门 与人员 信息维护,包括部门与人员的变动,工资类型\所属部门\职务\职等\特殊工龄\工龄工资标准\非系数人员执行工资标准\基本工资\通讯补贴\燃油补贴
*** 工资计算常量设置,包括保险基数\住房公积金
*** 使用非系数工资计算公式进行工资录入,导入ERP计时计件工资,导入excel数据,保存
*** 系数工资基础信维护,包括系数工资范围和绩效考核系数,绩效考核系数每个期间只能有一个数据.
*** 使用系数工资计算公式进行工资录入
*** 工资计算 ,完成
** 5.设计说明
*** 工资人员 增加字段:工资类型\职等\特殊工龄\工龄工资标准\非系数人员执行工资标准\基本工资\通讯补贴\燃油补贴,这些数据不经常修改,在这里进行维护.
*** 工资人员的显示顺序调整,便于查看
*** 计时计件工资数据从ERP里直接导入;excel数据导入
*** 绩效考核数据审核后,系统根据系数工资范围和职等算出平均工资,然后自动写到工资人员"系数执行工资标准"和工资项目的"系数执行工资标准".再次进行工资录入时,会根据系数执行工资标准进行计算.
